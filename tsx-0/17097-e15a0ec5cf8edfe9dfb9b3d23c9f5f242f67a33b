{"code":"(()=>{\n\"use strict\";var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});var __createBinding=exports&&exports.__createBinding||(Object.create?function(o,m,k,k2){if(k2===void 0)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||(\"get\"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===void 0)k2=k;o[k2]=m[k]});var __setModuleDefault=exports&&exports.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,\"default\",{enumerable:true,value:v})}:function(o,v){o[\"default\"]=v});var __importStar=exports&&exports.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null){for(var k in mod)if(k!==\"default\"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k)}__setModuleDefault(result,mod);return result};Object.defineProperty(exports,\"__esModule\",{value:true});exports.Parser=void 0;var Tokenizer_js_1=__importStar(require(\"./Tokenizer.js\"));var decode_js_1=require(\"entities/lib/decode.js\");var formTags=new Set([\"input\",\"option\",\"optgroup\",\"select\",\"button\",\"datalist\",\"textarea\"]);var pTag=new Set([\"p\"]);var tableSectionTags=new Set([\"thead\",\"tbody\"]);var ddtTags=new Set([\"dd\",\"dt\"]);var rtpTags=new Set([\"rt\",\"rp\"]);var openImpliesClose=new Map([[\"tr\",new Set([\"tr\",\"th\",\"td\"])],[\"th\",new Set([\"th\"])],[\"td\",new Set([\"thead\",\"th\",\"td\"])],[\"body\",new Set([\"head\",\"link\",\"script\"])],[\"li\",new Set([\"li\"])],[\"p\",pTag],[\"h1\",pTag],[\"h2\",pTag],[\"h3\",pTag],[\"h4\",pTag],[\"h5\",pTag],[\"h6\",pTag],[\"select\",formTags],[\"input\",formTags],[\"output\",formTags],[\"button\",formTags],[\"datalist\",formTags],[\"textarea\",formTags],[\"option\",new Set([\"option\"])],[\"optgroup\",new Set([\"optgroup\",\"option\"])],[\"dd\",ddtTags],[\"dt\",ddtTags],[\"address\",pTag],[\"article\",pTag],[\"aside\",pTag],[\"blockquote\",pTag],[\"details\",pTag],[\"div\",pTag],[\"dl\",pTag],[\"fieldset\",pTag],[\"figcaption\",pTag],[\"figure\",pTag],[\"footer\",pTag],[\"form\",pTag],[\"header\",pTag],[\"hr\",pTag],[\"main\",pTag],[\"nav\",pTag],[\"ol\",pTag],[\"pre\",pTag],[\"section\",pTag],[\"table\",pTag],[\"ul\",pTag],[\"rt\",rtpTags],[\"rp\",rtpTags],[\"tbody\",tableSectionTags],[\"tfoot\",tableSectionTags]]);var voidElements=new Set([\"area\",\"base\",\"basefont\",\"br\",\"col\",\"command\",\"embed\",\"frame\",\"hr\",\"img\",\"input\",\"isindex\",\"keygen\",\"link\",\"meta\",\"param\",\"source\",\"track\",\"wbr\"]);var foreignContextElements=new Set([\"math\",\"svg\"]);var htmlIntegrationElements=new Set([\"mi\",\"mo\",\"mn\",\"ms\",\"mtext\",\"annotation-xml\",\"foreignobject\",\"desc\",\"title\"]);var reNameEnd=/\\s|\\//;var Parser=function(){function Parser2(cbs,options){if(options===void 0){options={}}var _a,_b,_c,_d,_e;this.options=options;this.startIndex=0;this.endIndex=0;this.openTagStart=0;this.tagname=\"\";this.attribname=\"\";this.attribvalue=\"\";this.attribs=null;this.stack=[];this.foreignContext=[];this.buffers=[];this.bufferOffset=0;this.writeIndex=0;this.ended=false;this.cbs=cbs!==null&&cbs!==void 0?cbs:{};this.lowerCaseTagNames=(_a=options.lowerCaseTags)!==null&&_a!==void 0?_a:!options.xmlMode;this.lowerCaseAttributeNames=(_b=options.lowerCaseAttributeNames)!==null&&_b!==void 0?_b:!options.xmlMode;this.tokenizer=new((_c=options.Tokenizer)!==null&&_c!==void 0?_c:Tokenizer_js_1.default)(this.options,this);(_e=(_d=this.cbs).onparserinit)===null||_e===void 0?void 0:_e.call(_d,this)}__name(Parser2,\"Parser\");Parser2.prototype.ontext=function(start,endIndex){var _a,_b;var data=this.getSlice(start,endIndex);this.endIndex=endIndex-1;(_b=(_a=this.cbs).ontext)===null||_b===void 0?void 0:_b.call(_a,data);this.startIndex=endIndex};Parser2.prototype.ontextentity=function(cp){var _a,_b;var index=this.tokenizer.getSectionStart();this.endIndex=index-1;(_b=(_a=this.cbs).ontext)===null||_b===void 0?void 0:_b.call(_a,(0,decode_js_1.fromCodePoint)(cp));this.startIndex=index};Parser2.prototype.isVoidElement=function(name){return!this.options.xmlMode&&voidElements.has(name)};Parser2.prototype.onopentagname=function(start,endIndex){this.endIndex=endIndex;var name=this.getSlice(start,endIndex);if(this.lowerCaseTagNames){name=name.toLowerCase()}this.emitOpenTag(name)};Parser2.prototype.emitOpenTag=function(name){var _a,_b,_c,_d;this.openTagStart=this.startIndex;this.tagname=name;var impliesClose=!this.options.xmlMode&&openImpliesClose.get(name);if(impliesClose){while(this.stack.length>0&&impliesClose.has(this.stack[this.stack.length-1])){var element=this.stack.pop();(_b=(_a=this.cbs).onclosetag)===null||_b===void 0?void 0:_b.call(_a,element,true)}}if(!this.isVoidElement(name)){this.stack.push(name);if(foreignContextElements.has(name)){this.foreignContext.push(true)}else if(htmlIntegrationElements.has(name)){this.foreignContext.push(false)}}(_d=(_c=this.cbs).onopentagname)===null||_d===void 0?void 0:_d.call(_c,name);if(this.cbs.onopentag)this.attribs={}};Parser2.prototype.endOpenTag=function(isImplied){var _a,_b;this.startIndex=this.openTagStart;if(this.attribs){(_b=(_a=this.cbs).onopentag)===null||_b===void 0?void 0:_b.call(_a,this.tagname,this.attribs,isImplied);this.attribs=null}if(this.cbs.onclosetag&&this.isVoidElement(this.tagname)){this.cbs.onclosetag(this.tagname,true)}this.tagname=\"\"};Parser2.prototype.onopentagend=function(endIndex){this.endIndex=endIndex;this.endOpenTag(false);this.startIndex=endIndex+1};Parser2.prototype.onclosetag=function(start,endIndex){var _a,_b,_c,_d,_e,_f;this.endIndex=endIndex;var name=this.getSlice(start,endIndex);if(this.lowerCaseTagNames){name=name.toLowerCase()}if(foreignContextElements.has(name)||htmlIntegrationElements.has(name)){this.foreignContext.pop()}if(!this.isVoidElement(name)){var pos=this.stack.lastIndexOf(name);if(pos!==-1){if(this.cbs.onclosetag){var count=this.stack.length-pos;while(count--){this.cbs.onclosetag(this.stack.pop(),count!==0)}}else this.stack.length=pos}else if(!this.options.xmlMode&&name===\"p\"){this.emitOpenTag(\"p\");this.closeCurrentTag(true)}}else if(!this.options.xmlMode&&name===\"br\"){(_b=(_a=this.cbs).onopentagname)===null||_b===void 0?void 0:_b.call(_a,\"br\");(_d=(_c=this.cbs).onopentag)===null||_d===void 0?void 0:_d.call(_c,\"br\",{},true);(_f=(_e=this.cbs).onclosetag)===null||_f===void 0?void 0:_f.call(_e,\"br\",false)}this.startIndex=endIndex+1};Parser2.prototype.onselfclosingtag=function(endIndex){this.endIndex=endIndex;if(this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]){this.closeCurrentTag(false);this.startIndex=endIndex+1}else{this.onopentagend(endIndex)}};Parser2.prototype.closeCurrentTag=function(isOpenImplied){var _a,_b;var name=this.tagname;this.endOpenTag(isOpenImplied);if(this.stack[this.stack.length-1]===name){(_b=(_a=this.cbs).onclosetag)===null||_b===void 0?void 0:_b.call(_a,name,!isOpenImplied);this.stack.pop()}};Parser2.prototype.onattribname=function(start,endIndex){this.startIndex=start;var name=this.getSlice(start,endIndex);this.attribname=this.lowerCaseAttributeNames?name.toLowerCase():name};Parser2.prototype.onattribdata=function(start,endIndex){this.attribvalue+=this.getSlice(start,endIndex)};Parser2.prototype.onattribentity=function(cp){this.attribvalue+=(0,decode_js_1.fromCodePoint)(cp)};Parser2.prototype.onattribend=function(quote,endIndex){var _a,_b;this.endIndex=endIndex;(_b=(_a=this.cbs).onattribute)===null||_b===void 0?void 0:_b.call(_a,this.attribname,this.attribvalue,quote===Tokenizer_js_1.QuoteType.Double?'\"':quote===Tokenizer_js_1.QuoteType.Single?\"'\":quote===Tokenizer_js_1.QuoteType.NoValue?void 0:null);if(this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)){this.attribs[this.attribname]=this.attribvalue}this.attribvalue=\"\"};Parser2.prototype.getInstructionName=function(value){var index=value.search(reNameEnd);var name=index<0?value:value.substr(0,index);if(this.lowerCaseTagNames){name=name.toLowerCase()}return name};Parser2.prototype.ondeclaration=function(start,endIndex){this.endIndex=endIndex;var value=this.getSlice(start,endIndex);if(this.cbs.onprocessinginstruction){var name=this.getInstructionName(value);this.cbs.onprocessinginstruction(\"!\".concat(name),\"!\".concat(value))}this.startIndex=endIndex+1};Parser2.prototype.onprocessinginstruction=function(start,endIndex){this.endIndex=endIndex;var value=this.getSlice(start,endIndex);if(this.cbs.onprocessinginstruction){var name=this.getInstructionName(value);this.cbs.onprocessinginstruction(\"?\".concat(name),\"?\".concat(value))}this.startIndex=endIndex+1};Parser2.prototype.oncomment=function(start,endIndex,offset){var _a,_b,_c,_d;this.endIndex=endIndex;(_b=(_a=this.cbs).oncomment)===null||_b===void 0?void 0:_b.call(_a,this.getSlice(start,endIndex-offset));(_d=(_c=this.cbs).oncommentend)===null||_d===void 0?void 0:_d.call(_c);this.startIndex=endIndex+1};Parser2.prototype.oncdata=function(start,endIndex,offset){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k;this.endIndex=endIndex;var value=this.getSlice(start,endIndex-offset);if(this.options.xmlMode||this.options.recognizeCDATA){(_b=(_a=this.cbs).oncdatastart)===null||_b===void 0?void 0:_b.call(_a);(_d=(_c=this.cbs).ontext)===null||_d===void 0?void 0:_d.call(_c,value);(_f=(_e=this.cbs).oncdataend)===null||_f===void 0?void 0:_f.call(_e)}else{(_h=(_g=this.cbs).oncomment)===null||_h===void 0?void 0:_h.call(_g,\"[CDATA[\".concat(value,\"]]\"));(_k=(_j=this.cbs).oncommentend)===null||_k===void 0?void 0:_k.call(_j)}this.startIndex=endIndex+1};Parser2.prototype.onend=function(){var _a,_b;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(var index=this.stack.length;index>0;this.cbs.onclosetag(this.stack[--index],true));}(_b=(_a=this.cbs).onend)===null||_b===void 0?void 0:_b.call(_a)};Parser2.prototype.reset=function(){var _a,_b,_c,_d;(_b=(_a=this.cbs).onreset)===null||_b===void 0?void 0:_b.call(_a);this.tokenizer.reset();this.tagname=\"\";this.attribname=\"\";this.attribs=null;this.stack.length=0;this.startIndex=0;this.endIndex=0;(_d=(_c=this.cbs).onparserinit)===null||_d===void 0?void 0:_d.call(_c,this);this.buffers.length=0;this.bufferOffset=0;this.writeIndex=0;this.ended=false};Parser2.prototype.parseComplete=function(data){this.reset();this.end(data)};Parser2.prototype.getSlice=function(start,end){while(start-this.bufferOffset>=this.buffers[0].length){this.shiftBuffer()}var slice=this.buffers[0].slice(start-this.bufferOffset,end-this.bufferOffset);while(end-this.bufferOffset>this.buffers[0].length){this.shiftBuffer();slice+=this.buffers[0].slice(0,end-this.bufferOffset)}return slice};Parser2.prototype.shiftBuffer=function(){this.bufferOffset+=this.buffers[0].length;this.writeIndex--;this.buffers.shift()};Parser2.prototype.write=function(chunk){var _a,_b;if(this.ended){(_b=(_a=this.cbs).onerror)===null||_b===void 0?void 0:_b.call(_a,new Error(\".write() after done!\"));return}this.buffers.push(chunk);if(this.tokenizer.running){this.tokenizer.write(chunk);this.writeIndex++}};Parser2.prototype.end=function(chunk){var _a,_b;if(this.ended){(_b=(_a=this.cbs).onerror)===null||_b===void 0?void 0:_b.call(_a,new Error(\".end() after done!\"));return}if(chunk)this.write(chunk);this.ended=true;this.tokenizer.end()};Parser2.prototype.pause=function(){this.tokenizer.pause()};Parser2.prototype.resume=function(){this.tokenizer.resume();while(this.tokenizer.running&&this.writeIndex<this.buffers.length){this.tokenizer.write(this.buffers[this.writeIndex++])}if(this.ended)this.tokenizer.end()};Parser2.prototype.parseChunk=function(chunk){this.write(chunk)};Parser2.prototype.done=function(chunk){this.end(chunk)};return Parser2}();exports.Parser=Parser;\n})()\n","warnings":[],"map":{"version":3,"mappings":"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","names":["Parser"],"sources":["/Users/markbakker/RiderProjects/mycrm/node_modules/.pnpm/htmlparser2@8.0.2/node_modules/htmlparser2/lib/Parser.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Parser = void 0;\nvar Tokenizer_js_1 = __importStar(require(\"./Tokenizer.js\"));\nvar decode_js_1 = require(\"entities/lib/decode.js\");\nvar formTags = new Set([\n    \"input\",\n    \"option\",\n    \"optgroup\",\n    \"select\",\n    \"button\",\n    \"datalist\",\n    \"textarea\",\n]);\nvar pTag = new Set([\"p\"]);\nvar tableSectionTags = new Set([\"thead\", \"tbody\"]);\nvar ddtTags = new Set([\"dd\", \"dt\"]);\nvar rtpTags = new Set([\"rt\", \"rp\"]);\nvar openImpliesClose = new Map([\n    [\"tr\", new Set([\"tr\", \"th\", \"td\"])],\n    [\"th\", new Set([\"th\"])],\n    [\"td\", new Set([\"thead\", \"th\", \"td\"])],\n    [\"body\", new Set([\"head\", \"link\", \"script\"])],\n    [\"li\", new Set([\"li\"])],\n    [\"p\", pTag],\n    [\"h1\", pTag],\n    [\"h2\", pTag],\n    [\"h3\", pTag],\n    [\"h4\", pTag],\n    [\"h5\", pTag],\n    [\"h6\", pTag],\n    [\"select\", formTags],\n    [\"input\", formTags],\n    [\"output\", formTags],\n    [\"button\", formTags],\n    [\"datalist\", formTags],\n    [\"textarea\", formTags],\n    [\"option\", new Set([\"option\"])],\n    [\"optgroup\", new Set([\"optgroup\", \"option\"])],\n    [\"dd\", ddtTags],\n    [\"dt\", ddtTags],\n    [\"address\", pTag],\n    [\"article\", pTag],\n    [\"aside\", pTag],\n    [\"blockquote\", pTag],\n    [\"details\", pTag],\n    [\"div\", pTag],\n    [\"dl\", pTag],\n    [\"fieldset\", pTag],\n    [\"figcaption\", pTag],\n    [\"figure\", pTag],\n    [\"footer\", pTag],\n    [\"form\", pTag],\n    [\"header\", pTag],\n    [\"hr\", pTag],\n    [\"main\", pTag],\n    [\"nav\", pTag],\n    [\"ol\", pTag],\n    [\"pre\", pTag],\n    [\"section\", pTag],\n    [\"table\", pTag],\n    [\"ul\", pTag],\n    [\"rt\", rtpTags],\n    [\"rp\", rtpTags],\n    [\"tbody\", tableSectionTags],\n    [\"tfoot\", tableSectionTags],\n]);\nvar voidElements = new Set([\n    \"area\",\n    \"base\",\n    \"basefont\",\n    \"br\",\n    \"col\",\n    \"command\",\n    \"embed\",\n    \"frame\",\n    \"hr\",\n    \"img\",\n    \"input\",\n    \"isindex\",\n    \"keygen\",\n    \"link\",\n    \"meta\",\n    \"param\",\n    \"source\",\n    \"track\",\n    \"wbr\",\n]);\nvar foreignContextElements = new Set([\"math\", \"svg\"]);\nvar htmlIntegrationElements = new Set([\n    \"mi\",\n    \"mo\",\n    \"mn\",\n    \"ms\",\n    \"mtext\",\n    \"annotation-xml\",\n    \"foreignobject\",\n    \"desc\",\n    \"title\",\n]);\nvar reNameEnd = /\\s|\\//;\nvar Parser = /** @class */ (function () {\n    function Parser(cbs, options) {\n        if (options === void 0) { options = {}; }\n        var _a, _b, _c, _d, _e;\n        this.options = options;\n        /** The start index of the last event. */\n        this.startIndex = 0;\n        /** The end index of the last event. */\n        this.endIndex = 0;\n        /**\n         * Store the start index of the current open tag,\n         * so we can update the start index for attributes.\n         */\n        this.openTagStart = 0;\n        this.tagname = \"\";\n        this.attribname = \"\";\n        this.attribvalue = \"\";\n        this.attribs = null;\n        this.stack = [];\n        this.foreignContext = [];\n        this.buffers = [];\n        this.bufferOffset = 0;\n        /** The index of the last written buffer. Used when resuming after a `pause()`. */\n        this.writeIndex = 0;\n        /** Indicates whether the parser has finished running / `.end` has been called. */\n        this.ended = false;\n        this.cbs = cbs !== null && cbs !== void 0 ? cbs : {};\n        this.lowerCaseTagNames = (_a = options.lowerCaseTags) !== null && _a !== void 0 ? _a : !options.xmlMode;\n        this.lowerCaseAttributeNames =\n            (_b = options.lowerCaseAttributeNames) !== null && _b !== void 0 ? _b : !options.xmlMode;\n        this.tokenizer = new ((_c = options.Tokenizer) !== null && _c !== void 0 ? _c : Tokenizer_js_1.default)(this.options, this);\n        (_e = (_d = this.cbs).onparserinit) === null || _e === void 0 ? void 0 : _e.call(_d, this);\n    }\n    // Tokenizer event handlers\n    /** @internal */\n    Parser.prototype.ontext = function (start, endIndex) {\n        var _a, _b;\n        var data = this.getSlice(start, endIndex);\n        this.endIndex = endIndex - 1;\n        (_b = (_a = this.cbs).ontext) === null || _b === void 0 ? void 0 : _b.call(_a, data);\n        this.startIndex = endIndex;\n    };\n    /** @internal */\n    Parser.prototype.ontextentity = function (cp) {\n        var _a, _b;\n        /*\n         * Entities can be emitted on the character, or directly after.\n         * We use the section start here to get accurate indices.\n         */\n        var index = this.tokenizer.getSectionStart();\n        this.endIndex = index - 1;\n        (_b = (_a = this.cbs).ontext) === null || _b === void 0 ? void 0 : _b.call(_a, (0, decode_js_1.fromCodePoint)(cp));\n        this.startIndex = index;\n    };\n    Parser.prototype.isVoidElement = function (name) {\n        return !this.options.xmlMode && voidElements.has(name);\n    };\n    /** @internal */\n    Parser.prototype.onopentagname = function (start, endIndex) {\n        this.endIndex = endIndex;\n        var name = this.getSlice(start, endIndex);\n        if (this.lowerCaseTagNames) {\n            name = name.toLowerCase();\n        }\n        this.emitOpenTag(name);\n    };\n    Parser.prototype.emitOpenTag = function (name) {\n        var _a, _b, _c, _d;\n        this.openTagStart = this.startIndex;\n        this.tagname = name;\n        var impliesClose = !this.options.xmlMode && openImpliesClose.get(name);\n        if (impliesClose) {\n            while (this.stack.length > 0 &&\n                impliesClose.has(this.stack[this.stack.length - 1])) {\n                var element = this.stack.pop();\n                (_b = (_a = this.cbs).onclosetag) === null || _b === void 0 ? void 0 : _b.call(_a, element, true);\n            }\n        }\n        if (!this.isVoidElement(name)) {\n            this.stack.push(name);\n            if (foreignContextElements.has(name)) {\n                this.foreignContext.push(true);\n            }\n            else if (htmlIntegrationElements.has(name)) {\n                this.foreignContext.push(false);\n            }\n        }\n        (_d = (_c = this.cbs).onopentagname) === null || _d === void 0 ? void 0 : _d.call(_c, name);\n        if (this.cbs.onopentag)\n            this.attribs = {};\n    };\n    Parser.prototype.endOpenTag = function (isImplied) {\n        var _a, _b;\n        this.startIndex = this.openTagStart;\n        if (this.attribs) {\n            (_b = (_a = this.cbs).onopentag) === null || _b === void 0 ? void 0 : _b.call(_a, this.tagname, this.attribs, isImplied);\n            this.attribs = null;\n        }\n        if (this.cbs.onclosetag && this.isVoidElement(this.tagname)) {\n            this.cbs.onclosetag(this.tagname, true);\n        }\n        this.tagname = \"\";\n    };\n    /** @internal */\n    Parser.prototype.onopentagend = function (endIndex) {\n        this.endIndex = endIndex;\n        this.endOpenTag(false);\n        // Set `startIndex` for next node\n        this.startIndex = endIndex + 1;\n    };\n    /** @internal */\n    Parser.prototype.onclosetag = function (start, endIndex) {\n        var _a, _b, _c, _d, _e, _f;\n        this.endIndex = endIndex;\n        var name = this.getSlice(start, endIndex);\n        if (this.lowerCaseTagNames) {\n            name = name.toLowerCase();\n        }\n        if (foreignContextElements.has(name) ||\n            htmlIntegrationElements.has(name)) {\n            this.foreignContext.pop();\n        }\n        if (!this.isVoidElement(name)) {\n            var pos = this.stack.lastIndexOf(name);\n            if (pos !== -1) {\n                if (this.cbs.onclosetag) {\n                    var count = this.stack.length - pos;\n                    while (count--) {\n                        // We know the stack has sufficient elements.\n                        this.cbs.onclosetag(this.stack.pop(), count !== 0);\n                    }\n                }\n                else\n                    this.stack.length = pos;\n            }\n            else if (!this.options.xmlMode && name === \"p\") {\n                // Implicit open before close\n                this.emitOpenTag(\"p\");\n                this.closeCurrentTag(true);\n            }\n        }\n        else if (!this.options.xmlMode && name === \"br\") {\n            // We can't use `emitOpenTag` for implicit open, as `br` would be implicitly closed.\n            (_b = (_a = this.cbs).onopentagname) === null || _b === void 0 ? void 0 : _b.call(_a, \"br\");\n            (_d = (_c = this.cbs).onopentag) === null || _d === void 0 ? void 0 : _d.call(_c, \"br\", {}, true);\n            (_f = (_e = this.cbs).onclosetag) === null || _f === void 0 ? void 0 : _f.call(_e, \"br\", false);\n        }\n        // Set `startIndex` for next node\n        this.startIndex = endIndex + 1;\n    };\n    /** @internal */\n    Parser.prototype.onselfclosingtag = function (endIndex) {\n        this.endIndex = endIndex;\n        if (this.options.xmlMode ||\n            this.options.recognizeSelfClosing ||\n            this.foreignContext[this.foreignContext.length - 1]) {\n            this.closeCurrentTag(false);\n            // Set `startIndex` for next node\n            this.startIndex = endIndex + 1;\n        }\n        else {\n            // Ignore the fact that the tag is self-closing.\n            this.onopentagend(endIndex);\n        }\n    };\n    Parser.prototype.closeCurrentTag = function (isOpenImplied) {\n        var _a, _b;\n        var name = this.tagname;\n        this.endOpenTag(isOpenImplied);\n        // Self-closing tags will be on the top of the stack\n        if (this.stack[this.stack.length - 1] === name) {\n            // If the opening tag isn't implied, the closing tag has to be implied.\n            (_b = (_a = this.cbs).onclosetag) === null || _b === void 0 ? void 0 : _b.call(_a, name, !isOpenImplied);\n            this.stack.pop();\n        }\n    };\n    /** @internal */\n    Parser.prototype.onattribname = function (start, endIndex) {\n        this.startIndex = start;\n        var name = this.getSlice(start, endIndex);\n        this.attribname = this.lowerCaseAttributeNames\n            ? name.toLowerCase()\n            : name;\n    };\n    /** @internal */\n    Parser.prototype.onattribdata = function (start, endIndex) {\n        this.attribvalue += this.getSlice(start, endIndex);\n    };\n    /** @internal */\n    Parser.prototype.onattribentity = function (cp) {\n        this.attribvalue += (0, decode_js_1.fromCodePoint)(cp);\n    };\n    /** @internal */\n    Parser.prototype.onattribend = function (quote, endIndex) {\n        var _a, _b;\n        this.endIndex = endIndex;\n        (_b = (_a = this.cbs).onattribute) === null || _b === void 0 ? void 0 : _b.call(_a, this.attribname, this.attribvalue, quote === Tokenizer_js_1.QuoteType.Double\n            ? '\"'\n            : quote === Tokenizer_js_1.QuoteType.Single\n                ? \"'\"\n                : quote === Tokenizer_js_1.QuoteType.NoValue\n                    ? undefined\n                    : null);\n        if (this.attribs &&\n            !Object.prototype.hasOwnProperty.call(this.attribs, this.attribname)) {\n            this.attribs[this.attribname] = this.attribvalue;\n        }\n        this.attribvalue = \"\";\n    };\n    Parser.prototype.getInstructionName = function (value) {\n        var index = value.search(reNameEnd);\n        var name = index < 0 ? value : value.substr(0, index);\n        if (this.lowerCaseTagNames) {\n            name = name.toLowerCase();\n        }\n        return name;\n    };\n    /** @internal */\n    Parser.prototype.ondeclaration = function (start, endIndex) {\n        this.endIndex = endIndex;\n        var value = this.getSlice(start, endIndex);\n        if (this.cbs.onprocessinginstruction) {\n            var name = this.getInstructionName(value);\n            this.cbs.onprocessinginstruction(\"!\".concat(name), \"!\".concat(value));\n        }\n        // Set `startIndex` for next node\n        this.startIndex = endIndex + 1;\n    };\n    /** @internal */\n    Parser.prototype.onprocessinginstruction = function (start, endIndex) {\n        this.endIndex = endIndex;\n        var value = this.getSlice(start, endIndex);\n        if (this.cbs.onprocessinginstruction) {\n            var name = this.getInstructionName(value);\n            this.cbs.onprocessinginstruction(\"?\".concat(name), \"?\".concat(value));\n        }\n        // Set `startIndex` for next node\n        this.startIndex = endIndex + 1;\n    };\n    /** @internal */\n    Parser.prototype.oncomment = function (start, endIndex, offset) {\n        var _a, _b, _c, _d;\n        this.endIndex = endIndex;\n        (_b = (_a = this.cbs).oncomment) === null || _b === void 0 ? void 0 : _b.call(_a, this.getSlice(start, endIndex - offset));\n        (_d = (_c = this.cbs).oncommentend) === null || _d === void 0 ? void 0 : _d.call(_c);\n        // Set `startIndex` for next node\n        this.startIndex = endIndex + 1;\n    };\n    /** @internal */\n    Parser.prototype.oncdata = function (start, endIndex, offset) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;\n        this.endIndex = endIndex;\n        var value = this.getSlice(start, endIndex - offset);\n        if (this.options.xmlMode || this.options.recognizeCDATA) {\n            (_b = (_a = this.cbs).oncdatastart) === null || _b === void 0 ? void 0 : _b.call(_a);\n            (_d = (_c = this.cbs).ontext) === null || _d === void 0 ? void 0 : _d.call(_c, value);\n            (_f = (_e = this.cbs).oncdataend) === null || _f === void 0 ? void 0 : _f.call(_e);\n        }\n        else {\n            (_h = (_g = this.cbs).oncomment) === null || _h === void 0 ? void 0 : _h.call(_g, \"[CDATA[\".concat(value, \"]]\"));\n            (_k = (_j = this.cbs).oncommentend) === null || _k === void 0 ? void 0 : _k.call(_j);\n        }\n        // Set `startIndex` for next node\n        this.startIndex = endIndex + 1;\n    };\n    /** @internal */\n    Parser.prototype.onend = function () {\n        var _a, _b;\n        if (this.cbs.onclosetag) {\n            // Set the end index for all remaining tags\n            this.endIndex = this.startIndex;\n            for (var index = this.stack.length; index > 0; this.cbs.onclosetag(this.stack[--index], true))\n                ;\n        }\n        (_b = (_a = this.cbs).onend) === null || _b === void 0 ? void 0 : _b.call(_a);\n    };\n    /**\n     * Resets the parser to a blank state, ready to parse a new HTML document\n     */\n    Parser.prototype.reset = function () {\n        var _a, _b, _c, _d;\n        (_b = (_a = this.cbs).onreset) === null || _b === void 0 ? void 0 : _b.call(_a);\n        this.tokenizer.reset();\n        this.tagname = \"\";\n        this.attribname = \"\";\n        this.attribs = null;\n        this.stack.length = 0;\n        this.startIndex = 0;\n        this.endIndex = 0;\n        (_d = (_c = this.cbs).onparserinit) === null || _d === void 0 ? void 0 : _d.call(_c, this);\n        this.buffers.length = 0;\n        this.bufferOffset = 0;\n        this.writeIndex = 0;\n        this.ended = false;\n    };\n    /**\n     * Resets the parser, then parses a complete document and\n     * pushes it to the handler.\n     *\n     * @param data Document to parse.\n     */\n    Parser.prototype.parseComplete = function (data) {\n        this.reset();\n        this.end(data);\n    };\n    Parser.prototype.getSlice = function (start, end) {\n        while (start - this.bufferOffset >= this.buffers[0].length) {\n            this.shiftBuffer();\n        }\n        var slice = this.buffers[0].slice(start - this.bufferOffset, end - this.bufferOffset);\n        while (end - this.bufferOffset > this.buffers[0].length) {\n            this.shiftBuffer();\n            slice += this.buffers[0].slice(0, end - this.bufferOffset);\n        }\n        return slice;\n    };\n    Parser.prototype.shiftBuffer = function () {\n        this.bufferOffset += this.buffers[0].length;\n        this.writeIndex--;\n        this.buffers.shift();\n    };\n    /**\n     * Parses a chunk of data and calls the corresponding callbacks.\n     *\n     * @param chunk Chunk to parse.\n     */\n    Parser.prototype.write = function (chunk) {\n        var _a, _b;\n        if (this.ended) {\n            (_b = (_a = this.cbs).onerror) === null || _b === void 0 ? void 0 : _b.call(_a, new Error(\".write() after done!\"));\n            return;\n        }\n        this.buffers.push(chunk);\n        if (this.tokenizer.running) {\n            this.tokenizer.write(chunk);\n            this.writeIndex++;\n        }\n    };\n    /**\n     * Parses the end of the buffer and clears the stack, calls onend.\n     *\n     * @param chunk Optional final chunk to parse.\n     */\n    Parser.prototype.end = function (chunk) {\n        var _a, _b;\n        if (this.ended) {\n            (_b = (_a = this.cbs).onerror) === null || _b === void 0 ? void 0 : _b.call(_a, new Error(\".end() after done!\"));\n            return;\n        }\n        if (chunk)\n            this.write(chunk);\n        this.ended = true;\n        this.tokenizer.end();\n    };\n    /**\n     * Pauses parsing. The parser won't emit events until `resume` is called.\n     */\n    Parser.prototype.pause = function () {\n        this.tokenizer.pause();\n    };\n    /**\n     * Resumes parsing after `pause` was called.\n     */\n    Parser.prototype.resume = function () {\n        this.tokenizer.resume();\n        while (this.tokenizer.running &&\n            this.writeIndex < this.buffers.length) {\n            this.tokenizer.write(this.buffers[this.writeIndex++]);\n        }\n        if (this.ended)\n            this.tokenizer.end();\n    };\n    /**\n     * Alias of `write`, for backwards compatibility.\n     *\n     * @param chunk Chunk to parse.\n     * @deprecated\n     */\n    Parser.prototype.parseChunk = function (chunk) {\n        this.write(chunk);\n    };\n    /**\n     * Alias of `end`, for backwards compatibility.\n     *\n     * @param chunk Optional final chunk to parse.\n     * @deprecated\n     */\n    Parser.prototype.done = function (chunk) {\n        this.end(chunk);\n    };\n    return Parser;\n}());\nexports.Parser = Parser;\n//# sourceMappingURL=Parser.js.map"]}}