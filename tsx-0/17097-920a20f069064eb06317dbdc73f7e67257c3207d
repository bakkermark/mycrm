{"code":"(()=>{\n\"use strict\";var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});Object.defineProperty(exports,\"__esModule\",{value:true});exports.OpenElementStack=void 0;const html_js_1=require(\"../common/html.js\");const IMPLICIT_END_TAG_REQUIRED=new Set([html_js_1.TAG_ID.DD,html_js_1.TAG_ID.DT,html_js_1.TAG_ID.LI,html_js_1.TAG_ID.OPTGROUP,html_js_1.TAG_ID.OPTION,html_js_1.TAG_ID.P,html_js_1.TAG_ID.RB,html_js_1.TAG_ID.RP,html_js_1.TAG_ID.RT,html_js_1.TAG_ID.RTC]);const IMPLICIT_END_TAG_REQUIRED_THOROUGHLY=new Set([...IMPLICIT_END_TAG_REQUIRED,html_js_1.TAG_ID.CAPTION,html_js_1.TAG_ID.COLGROUP,html_js_1.TAG_ID.TBODY,html_js_1.TAG_ID.TD,html_js_1.TAG_ID.TFOOT,html_js_1.TAG_ID.TH,html_js_1.TAG_ID.THEAD,html_js_1.TAG_ID.TR]);const SCOPING_ELEMENT_NS=new Map([[html_js_1.TAG_ID.APPLET,html_js_1.NS.HTML],[html_js_1.TAG_ID.CAPTION,html_js_1.NS.HTML],[html_js_1.TAG_ID.HTML,html_js_1.NS.HTML],[html_js_1.TAG_ID.MARQUEE,html_js_1.NS.HTML],[html_js_1.TAG_ID.OBJECT,html_js_1.NS.HTML],[html_js_1.TAG_ID.TABLE,html_js_1.NS.HTML],[html_js_1.TAG_ID.TD,html_js_1.NS.HTML],[html_js_1.TAG_ID.TEMPLATE,html_js_1.NS.HTML],[html_js_1.TAG_ID.TH,html_js_1.NS.HTML],[html_js_1.TAG_ID.ANNOTATION_XML,html_js_1.NS.MATHML],[html_js_1.TAG_ID.MI,html_js_1.NS.MATHML],[html_js_1.TAG_ID.MN,html_js_1.NS.MATHML],[html_js_1.TAG_ID.MO,html_js_1.NS.MATHML],[html_js_1.TAG_ID.MS,html_js_1.NS.MATHML],[html_js_1.TAG_ID.MTEXT,html_js_1.NS.MATHML],[html_js_1.TAG_ID.DESC,html_js_1.NS.SVG],[html_js_1.TAG_ID.FOREIGN_OBJECT,html_js_1.NS.SVG],[html_js_1.TAG_ID.TITLE,html_js_1.NS.SVG]]);const NAMED_HEADERS=[html_js_1.TAG_ID.H1,html_js_1.TAG_ID.H2,html_js_1.TAG_ID.H3,html_js_1.TAG_ID.H4,html_js_1.TAG_ID.H5,html_js_1.TAG_ID.H6];const TABLE_ROW_CONTEXT=[html_js_1.TAG_ID.TR,html_js_1.TAG_ID.TEMPLATE,html_js_1.TAG_ID.HTML];const TABLE_BODY_CONTEXT=[html_js_1.TAG_ID.TBODY,html_js_1.TAG_ID.TFOOT,html_js_1.TAG_ID.THEAD,html_js_1.TAG_ID.TEMPLATE,html_js_1.TAG_ID.HTML];const TABLE_CONTEXT=[html_js_1.TAG_ID.TABLE,html_js_1.TAG_ID.TEMPLATE,html_js_1.TAG_ID.HTML];const TABLE_CELLS=[html_js_1.TAG_ID.TD,html_js_1.TAG_ID.TH];class OpenElementStack{static{__name(this,\"OpenElementStack\")}get currentTmplContentOrNode(){return this._isInTemplate()?this.treeAdapter.getTemplateContent(this.current):this.current}constructor(document,treeAdapter,handler){this.treeAdapter=treeAdapter;this.handler=handler;this.items=[];this.tagIDs=[];this.stackTop=-1;this.tmplCount=0;this.currentTagId=html_js_1.TAG_ID.UNKNOWN;this.current=document}_indexOf(element){return this.items.lastIndexOf(element,this.stackTop)}_isInTemplate(){return this.currentTagId===html_js_1.TAG_ID.TEMPLATE&&this.treeAdapter.getNamespaceURI(this.current)===html_js_1.NS.HTML}_updateCurrentElement(){this.current=this.items[this.stackTop];this.currentTagId=this.tagIDs[this.stackTop]}push(element,tagID){this.stackTop++;this.items[this.stackTop]=element;this.current=element;this.tagIDs[this.stackTop]=tagID;this.currentTagId=tagID;if(this._isInTemplate()){this.tmplCount++}this.handler.onItemPush(element,tagID,true)}pop(){const popped=this.current;if(this.tmplCount>0&&this._isInTemplate()){this.tmplCount--}this.stackTop--;this._updateCurrentElement();this.handler.onItemPop(popped,true)}replace(oldElement,newElement){const idx=this._indexOf(oldElement);this.items[idx]=newElement;if(idx===this.stackTop){this.current=newElement}}insertAfter(referenceElement,newElement,newElementID){const insertionIdx=this._indexOf(referenceElement)+1;this.items.splice(insertionIdx,0,newElement);this.tagIDs.splice(insertionIdx,0,newElementID);this.stackTop++;if(insertionIdx===this.stackTop){this._updateCurrentElement()}this.handler.onItemPush(this.current,this.currentTagId,insertionIdx===this.stackTop)}popUntilTagNamePopped(tagName){let targetIdx=this.stackTop+1;do{targetIdx=this.tagIDs.lastIndexOf(tagName,targetIdx-1)}while(targetIdx>0&&this.treeAdapter.getNamespaceURI(this.items[targetIdx])!==html_js_1.NS.HTML);this.shortenToLength(targetIdx<0?0:targetIdx)}shortenToLength(idx){while(this.stackTop>=idx){const popped=this.current;if(this.tmplCount>0&&this._isInTemplate()){this.tmplCount-=1}this.stackTop--;this._updateCurrentElement();this.handler.onItemPop(popped,this.stackTop<idx)}}popUntilElementPopped(element){const idx=this._indexOf(element);this.shortenToLength(idx<0?0:idx)}popUntilPopped(tagNames,targetNS){const idx=this._indexOfTagNames(tagNames,targetNS);this.shortenToLength(idx<0?0:idx)}popUntilNumberedHeaderPopped(){this.popUntilPopped(NAMED_HEADERS,html_js_1.NS.HTML)}popUntilTableCellPopped(){this.popUntilPopped(TABLE_CELLS,html_js_1.NS.HTML)}popAllUpToHtmlElement(){this.tmplCount=0;this.shortenToLength(1)}_indexOfTagNames(tagNames,namespace){for(let i=this.stackTop;i>=0;i--){if(tagNames.includes(this.tagIDs[i])&&this.treeAdapter.getNamespaceURI(this.items[i])===namespace){return i}}return-1}clearBackTo(tagNames,targetNS){const idx=this._indexOfTagNames(tagNames,targetNS);this.shortenToLength(idx+1)}clearBackToTableContext(){this.clearBackTo(TABLE_CONTEXT,html_js_1.NS.HTML)}clearBackToTableBodyContext(){this.clearBackTo(TABLE_BODY_CONTEXT,html_js_1.NS.HTML)}clearBackToTableRowContext(){this.clearBackTo(TABLE_ROW_CONTEXT,html_js_1.NS.HTML)}remove(element){const idx=this._indexOf(element);if(idx>=0){if(idx===this.stackTop){this.pop()}else{this.items.splice(idx,1);this.tagIDs.splice(idx,1);this.stackTop--;this._updateCurrentElement();this.handler.onItemPop(element,false)}}}tryPeekProperlyNestedBodyElement(){return this.stackTop>=1&&this.tagIDs[1]===html_js_1.TAG_ID.BODY?this.items[1]:null}contains(element){return this._indexOf(element)>-1}getCommonAncestor(element){const elementIdx=this._indexOf(element)-1;return elementIdx>=0?this.items[elementIdx]:null}isRootHtmlElementCurrent(){return this.stackTop===0&&this.tagIDs[0]===html_js_1.TAG_ID.HTML}hasInScope(tagName){for(let i=this.stackTop;i>=0;i--){const tn=this.tagIDs[i];const ns=this.treeAdapter.getNamespaceURI(this.items[i]);if(tn===tagName&&ns===html_js_1.NS.HTML){return true}if(SCOPING_ELEMENT_NS.get(tn)===ns){return false}}return true}hasNumberedHeaderInScope(){for(let i=this.stackTop;i>=0;i--){const tn=this.tagIDs[i];const ns=this.treeAdapter.getNamespaceURI(this.items[i]);if((0,html_js_1.isNumberedHeader)(tn)&&ns===html_js_1.NS.HTML){return true}if(SCOPING_ELEMENT_NS.get(tn)===ns){return false}}return true}hasInListItemScope(tagName){for(let i=this.stackTop;i>=0;i--){const tn=this.tagIDs[i];const ns=this.treeAdapter.getNamespaceURI(this.items[i]);if(tn===tagName&&ns===html_js_1.NS.HTML){return true}if((tn===html_js_1.TAG_ID.UL||tn===html_js_1.TAG_ID.OL)&&ns===html_js_1.NS.HTML||SCOPING_ELEMENT_NS.get(tn)===ns){return false}}return true}hasInButtonScope(tagName){for(let i=this.stackTop;i>=0;i--){const tn=this.tagIDs[i];const ns=this.treeAdapter.getNamespaceURI(this.items[i]);if(tn===tagName&&ns===html_js_1.NS.HTML){return true}if(tn===html_js_1.TAG_ID.BUTTON&&ns===html_js_1.NS.HTML||SCOPING_ELEMENT_NS.get(tn)===ns){return false}}return true}hasInTableScope(tagName){for(let i=this.stackTop;i>=0;i--){const tn=this.tagIDs[i];const ns=this.treeAdapter.getNamespaceURI(this.items[i]);if(ns!==html_js_1.NS.HTML){continue}if(tn===tagName){return true}if(tn===html_js_1.TAG_ID.TABLE||tn===html_js_1.TAG_ID.TEMPLATE||tn===html_js_1.TAG_ID.HTML){return false}}return true}hasTableBodyContextInTableScope(){for(let i=this.stackTop;i>=0;i--){const tn=this.tagIDs[i];const ns=this.treeAdapter.getNamespaceURI(this.items[i]);if(ns!==html_js_1.NS.HTML){continue}if(tn===html_js_1.TAG_ID.TBODY||tn===html_js_1.TAG_ID.THEAD||tn===html_js_1.TAG_ID.TFOOT){return true}if(tn===html_js_1.TAG_ID.TABLE||tn===html_js_1.TAG_ID.HTML){return false}}return true}hasInSelectScope(tagName){for(let i=this.stackTop;i>=0;i--){const tn=this.tagIDs[i];const ns=this.treeAdapter.getNamespaceURI(this.items[i]);if(ns!==html_js_1.NS.HTML){continue}if(tn===tagName){return true}if(tn!==html_js_1.TAG_ID.OPTION&&tn!==html_js_1.TAG_ID.OPTGROUP){return false}}return true}generateImpliedEndTags(){while(IMPLICIT_END_TAG_REQUIRED.has(this.currentTagId)){this.pop()}}generateImpliedEndTagsThoroughly(){while(IMPLICIT_END_TAG_REQUIRED_THOROUGHLY.has(this.currentTagId)){this.pop()}}generateImpliedEndTagsWithExclusion(exclusionId){while(this.currentTagId!==exclusionId&&IMPLICIT_END_TAG_REQUIRED_THOROUGHLY.has(this.currentTagId)){this.pop()}}}exports.OpenElementStack=OpenElementStack;\n})()\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"sources":["/Users/markbakker/RiderProjects/mycrm/node_modules/.pnpm/parse5@7.1.2/node_modules/parse5/dist/cjs/parser/open-element-stack.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.OpenElementStack = void 0;\nconst html_js_1 = require(\"../common/html.js\");\n//Element utils\nconst IMPLICIT_END_TAG_REQUIRED = new Set([html_js_1.TAG_ID.DD, html_js_1.TAG_ID.DT, html_js_1.TAG_ID.LI, html_js_1.TAG_ID.OPTGROUP, html_js_1.TAG_ID.OPTION, html_js_1.TAG_ID.P, html_js_1.TAG_ID.RB, html_js_1.TAG_ID.RP, html_js_1.TAG_ID.RT, html_js_1.TAG_ID.RTC]);\nconst IMPLICIT_END_TAG_REQUIRED_THOROUGHLY = new Set([\n    ...IMPLICIT_END_TAG_REQUIRED,\n    html_js_1.TAG_ID.CAPTION,\n    html_js_1.TAG_ID.COLGROUP,\n    html_js_1.TAG_ID.TBODY,\n    html_js_1.TAG_ID.TD,\n    html_js_1.TAG_ID.TFOOT,\n    html_js_1.TAG_ID.TH,\n    html_js_1.TAG_ID.THEAD,\n    html_js_1.TAG_ID.TR,\n]);\nconst SCOPING_ELEMENT_NS = new Map([\n    [html_js_1.TAG_ID.APPLET, html_js_1.NS.HTML],\n    [html_js_1.TAG_ID.CAPTION, html_js_1.NS.HTML],\n    [html_js_1.TAG_ID.HTML, html_js_1.NS.HTML],\n    [html_js_1.TAG_ID.MARQUEE, html_js_1.NS.HTML],\n    [html_js_1.TAG_ID.OBJECT, html_js_1.NS.HTML],\n    [html_js_1.TAG_ID.TABLE, html_js_1.NS.HTML],\n    [html_js_1.TAG_ID.TD, html_js_1.NS.HTML],\n    [html_js_1.TAG_ID.TEMPLATE, html_js_1.NS.HTML],\n    [html_js_1.TAG_ID.TH, html_js_1.NS.HTML],\n    [html_js_1.TAG_ID.ANNOTATION_XML, html_js_1.NS.MATHML],\n    [html_js_1.TAG_ID.MI, html_js_1.NS.MATHML],\n    [html_js_1.TAG_ID.MN, html_js_1.NS.MATHML],\n    [html_js_1.TAG_ID.MO, html_js_1.NS.MATHML],\n    [html_js_1.TAG_ID.MS, html_js_1.NS.MATHML],\n    [html_js_1.TAG_ID.MTEXT, html_js_1.NS.MATHML],\n    [html_js_1.TAG_ID.DESC, html_js_1.NS.SVG],\n    [html_js_1.TAG_ID.FOREIGN_OBJECT, html_js_1.NS.SVG],\n    [html_js_1.TAG_ID.TITLE, html_js_1.NS.SVG],\n]);\nconst NAMED_HEADERS = [html_js_1.TAG_ID.H1, html_js_1.TAG_ID.H2, html_js_1.TAG_ID.H3, html_js_1.TAG_ID.H4, html_js_1.TAG_ID.H5, html_js_1.TAG_ID.H6];\nconst TABLE_ROW_CONTEXT = [html_js_1.TAG_ID.TR, html_js_1.TAG_ID.TEMPLATE, html_js_1.TAG_ID.HTML];\nconst TABLE_BODY_CONTEXT = [html_js_1.TAG_ID.TBODY, html_js_1.TAG_ID.TFOOT, html_js_1.TAG_ID.THEAD, html_js_1.TAG_ID.TEMPLATE, html_js_1.TAG_ID.HTML];\nconst TABLE_CONTEXT = [html_js_1.TAG_ID.TABLE, html_js_1.TAG_ID.TEMPLATE, html_js_1.TAG_ID.HTML];\nconst TABLE_CELLS = [html_js_1.TAG_ID.TD, html_js_1.TAG_ID.TH];\n//Stack of open elements\nclass OpenElementStack {\n    get currentTmplContentOrNode() {\n        return this._isInTemplate() ? this.treeAdapter.getTemplateContent(this.current) : this.current;\n    }\n    constructor(document, treeAdapter, handler) {\n        this.treeAdapter = treeAdapter;\n        this.handler = handler;\n        this.items = [];\n        this.tagIDs = [];\n        this.stackTop = -1;\n        this.tmplCount = 0;\n        this.currentTagId = html_js_1.TAG_ID.UNKNOWN;\n        this.current = document;\n    }\n    //Index of element\n    _indexOf(element) {\n        return this.items.lastIndexOf(element, this.stackTop);\n    }\n    //Update current element\n    _isInTemplate() {\n        return this.currentTagId === html_js_1.TAG_ID.TEMPLATE && this.treeAdapter.getNamespaceURI(this.current) === html_js_1.NS.HTML;\n    }\n    _updateCurrentElement() {\n        this.current = this.items[this.stackTop];\n        this.currentTagId = this.tagIDs[this.stackTop];\n    }\n    //Mutations\n    push(element, tagID) {\n        this.stackTop++;\n        this.items[this.stackTop] = element;\n        this.current = element;\n        this.tagIDs[this.stackTop] = tagID;\n        this.currentTagId = tagID;\n        if (this._isInTemplate()) {\n            this.tmplCount++;\n        }\n        this.handler.onItemPush(element, tagID, true);\n    }\n    pop() {\n        const popped = this.current;\n        if (this.tmplCount > 0 && this._isInTemplate()) {\n            this.tmplCount--;\n        }\n        this.stackTop--;\n        this._updateCurrentElement();\n        this.handler.onItemPop(popped, true);\n    }\n    replace(oldElement, newElement) {\n        const idx = this._indexOf(oldElement);\n        this.items[idx] = newElement;\n        if (idx === this.stackTop) {\n            this.current = newElement;\n        }\n    }\n    insertAfter(referenceElement, newElement, newElementID) {\n        const insertionIdx = this._indexOf(referenceElement) + 1;\n        this.items.splice(insertionIdx, 0, newElement);\n        this.tagIDs.splice(insertionIdx, 0, newElementID);\n        this.stackTop++;\n        if (insertionIdx === this.stackTop) {\n            this._updateCurrentElement();\n        }\n        this.handler.onItemPush(this.current, this.currentTagId, insertionIdx === this.stackTop);\n    }\n    popUntilTagNamePopped(tagName) {\n        let targetIdx = this.stackTop + 1;\n        do {\n            targetIdx = this.tagIDs.lastIndexOf(tagName, targetIdx - 1);\n        } while (targetIdx > 0 && this.treeAdapter.getNamespaceURI(this.items[targetIdx]) !== html_js_1.NS.HTML);\n        this.shortenToLength(targetIdx < 0 ? 0 : targetIdx);\n    }\n    shortenToLength(idx) {\n        while (this.stackTop >= idx) {\n            const popped = this.current;\n            if (this.tmplCount > 0 && this._isInTemplate()) {\n                this.tmplCount -= 1;\n            }\n            this.stackTop--;\n            this._updateCurrentElement();\n            this.handler.onItemPop(popped, this.stackTop < idx);\n        }\n    }\n    popUntilElementPopped(element) {\n        const idx = this._indexOf(element);\n        this.shortenToLength(idx < 0 ? 0 : idx);\n    }\n    popUntilPopped(tagNames, targetNS) {\n        const idx = this._indexOfTagNames(tagNames, targetNS);\n        this.shortenToLength(idx < 0 ? 0 : idx);\n    }\n    popUntilNumberedHeaderPopped() {\n        this.popUntilPopped(NAMED_HEADERS, html_js_1.NS.HTML);\n    }\n    popUntilTableCellPopped() {\n        this.popUntilPopped(TABLE_CELLS, html_js_1.NS.HTML);\n    }\n    popAllUpToHtmlElement() {\n        //NOTE: here we assume that the root <html> element is always first in the open element stack, so\n        //we perform this fast stack clean up.\n        this.tmplCount = 0;\n        this.shortenToLength(1);\n    }\n    _indexOfTagNames(tagNames, namespace) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            if (tagNames.includes(this.tagIDs[i]) && this.treeAdapter.getNamespaceURI(this.items[i]) === namespace) {\n                return i;\n            }\n        }\n        return -1;\n    }\n    clearBackTo(tagNames, targetNS) {\n        const idx = this._indexOfTagNames(tagNames, targetNS);\n        this.shortenToLength(idx + 1);\n    }\n    clearBackToTableContext() {\n        this.clearBackTo(TABLE_CONTEXT, html_js_1.NS.HTML);\n    }\n    clearBackToTableBodyContext() {\n        this.clearBackTo(TABLE_BODY_CONTEXT, html_js_1.NS.HTML);\n    }\n    clearBackToTableRowContext() {\n        this.clearBackTo(TABLE_ROW_CONTEXT, html_js_1.NS.HTML);\n    }\n    remove(element) {\n        const idx = this._indexOf(element);\n        if (idx >= 0) {\n            if (idx === this.stackTop) {\n                this.pop();\n            }\n            else {\n                this.items.splice(idx, 1);\n                this.tagIDs.splice(idx, 1);\n                this.stackTop--;\n                this._updateCurrentElement();\n                this.handler.onItemPop(element, false);\n            }\n        }\n    }\n    //Search\n    tryPeekProperlyNestedBodyElement() {\n        //Properly nested <body> element (should be second element in stack).\n        return this.stackTop >= 1 && this.tagIDs[1] === html_js_1.TAG_ID.BODY ? this.items[1] : null;\n    }\n    contains(element) {\n        return this._indexOf(element) > -1;\n    }\n    getCommonAncestor(element) {\n        const elementIdx = this._indexOf(element) - 1;\n        return elementIdx >= 0 ? this.items[elementIdx] : null;\n    }\n    isRootHtmlElementCurrent() {\n        return this.stackTop === 0 && this.tagIDs[0] === html_js_1.TAG_ID.HTML;\n    }\n    //Element in scope\n    hasInScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n            if (tn === tagName && ns === html_js_1.NS.HTML) {\n                return true;\n            }\n            if (SCOPING_ELEMENT_NS.get(tn) === ns) {\n                return false;\n            }\n        }\n        return true;\n    }\n    hasNumberedHeaderInScope() {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n            if ((0, html_js_1.isNumberedHeader)(tn) && ns === html_js_1.NS.HTML) {\n                return true;\n            }\n            if (SCOPING_ELEMENT_NS.get(tn) === ns) {\n                return false;\n            }\n        }\n        return true;\n    }\n    hasInListItemScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n            if (tn === tagName && ns === html_js_1.NS.HTML) {\n                return true;\n            }\n            if (((tn === html_js_1.TAG_ID.UL || tn === html_js_1.TAG_ID.OL) && ns === html_js_1.NS.HTML) || SCOPING_ELEMENT_NS.get(tn) === ns) {\n                return false;\n            }\n        }\n        return true;\n    }\n    hasInButtonScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n            if (tn === tagName && ns === html_js_1.NS.HTML) {\n                return true;\n            }\n            if ((tn === html_js_1.TAG_ID.BUTTON && ns === html_js_1.NS.HTML) || SCOPING_ELEMENT_NS.get(tn) === ns) {\n                return false;\n            }\n        }\n        return true;\n    }\n    hasInTableScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n            if (ns !== html_js_1.NS.HTML) {\n                continue;\n            }\n            if (tn === tagName) {\n                return true;\n            }\n            if (tn === html_js_1.TAG_ID.TABLE || tn === html_js_1.TAG_ID.TEMPLATE || tn === html_js_1.TAG_ID.HTML) {\n                return false;\n            }\n        }\n        return true;\n    }\n    hasTableBodyContextInTableScope() {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n            if (ns !== html_js_1.NS.HTML) {\n                continue;\n            }\n            if (tn === html_js_1.TAG_ID.TBODY || tn === html_js_1.TAG_ID.THEAD || tn === html_js_1.TAG_ID.TFOOT) {\n                return true;\n            }\n            if (tn === html_js_1.TAG_ID.TABLE || tn === html_js_1.TAG_ID.HTML) {\n                return false;\n            }\n        }\n        return true;\n    }\n    hasInSelectScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n            if (ns !== html_js_1.NS.HTML) {\n                continue;\n            }\n            if (tn === tagName) {\n                return true;\n            }\n            if (tn !== html_js_1.TAG_ID.OPTION && tn !== html_js_1.TAG_ID.OPTGROUP) {\n                return false;\n            }\n        }\n        return true;\n    }\n    //Implied end tags\n    generateImpliedEndTags() {\n        while (IMPLICIT_END_TAG_REQUIRED.has(this.currentTagId)) {\n            this.pop();\n        }\n    }\n    generateImpliedEndTagsThoroughly() {\n        while (IMPLICIT_END_TAG_REQUIRED_THOROUGHLY.has(this.currentTagId)) {\n            this.pop();\n        }\n    }\n    generateImpliedEndTagsWithExclusion(exclusionId) {\n        while (this.currentTagId !== exclusionId && IMPLICIT_END_TAG_REQUIRED_THOROUGHLY.has(this.currentTagId)) {\n            this.pop();\n        }\n    }\n}\nexports.OpenElementStack = OpenElementStack;\n//# sourceMappingURL=open-element-stack.js.map"]}}